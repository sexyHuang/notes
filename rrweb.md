# RRWEB

## 介绍

rrweb是一个开源的web session replay库，它可以将页面中的**DOM**已经**用户操作**保存为**可序列化**的数据，以实现远程回放。

## 录制原理

### DOM 快照

DOM树的时间切片

#### 序列化 DOM 快照的重点

简单的DOM节点深克隆（`cloneNode`）对象并不是一个可序列化的对象（会丢失input的value值等），所以需要自己实现一个序列化方法，功能：

1. 尽量记录CSS样式表
1. 去脚本化
1. 记录没有反应在HTML中的视图状态

### 录制方案：关键帧 + 操作log

基于视图变更操作录制，变更操作包括：

- DOM 变动（通过MutationObserver收集）
- 鼠标移动
- 输入（input、textarea、select）
- 人为交互（监听input、change）
- 程序设置（劫持元素属性的setter）

## 回放原理

1. 在沙盒将快照重建为DOM树（沙盒通过iframe实现，通过sandbox属性实现去脚本化）
1. 将操作log的操作按照时间戳排列，放⼊⼀个操作队列中。
1. 通过计时器，定时从操作队列中取出操作，重现操作。
